# æ•°æ®åº“æ¸…ç†å½±å“åˆ†ææŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

å·²æˆåŠŸåˆ é™¤æœªä½¿ç”¨çš„æ•°æ®åº“è¡¨å®šä¹‰å’Œç›¸å…³ä»£ç ã€‚é¡¹ç›®**å¯ä»¥æ­£å¸¸è¿è¡Œ**ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å‡ä½¿ç”¨æ­£ç¡®çš„ API ç«¯ç‚¹ã€‚

## âœ… å·²åˆ é™¤çš„è¡¨

### 1. **AdminUser**ï¼ˆç®¡ç†å‘˜ç”¨æˆ·è¡¨ï¼‰
- **çŠ¶æ€**ï¼šå·²ä» `schema.prisma` åˆ é™¤
- **å½±å“**ï¼šæ— å½±å“ï¼Œé¡¹ç›®å·²è¿ç§»åˆ° `User` è¡¨

### 2. **SiteConfig**ï¼ˆç«™ç‚¹é…ç½®è¡¨ï¼‰
- **çŠ¶æ€**ï¼šå·²ä» `schema.prisma` åˆ é™¤
- **å½±å“**ï¼šæ— å½±å“ï¼Œç«™ç‚¹é…ç½®å·²è¿ç§»åˆ° `Page` è¡¨çš„ `draftConfig` å’Œ `publishedConfig`

### 3. **PasswordResetToken**ï¼ˆç®¡ç†å‘˜å¯†ç é‡ç½® Token è¡¨ï¼‰
- **çŠ¶æ€**ï¼šå·²ä» `schema.prisma` åˆ é™¤
- **å½±å“**ï¼šæ— å½±å“ï¼Œé¡¹ç›®ä½¿ç”¨ `UserPasswordResetToken` è¡¨

## âœ… å·²æ›´æ–°çš„è¡¨

### **MediaAsset**ï¼ˆåª’ä½“èµ„æºè¡¨ï¼‰
- **å˜æ›´**ï¼šç§»é™¤äº† `adminUserId` å’Œ `adminUser` å…³ç³»
- **ä¿ç•™**ï¼šä»…ä¿ç•™ `userId` å’Œ `user` å…³ç³»ï¼ˆå…³è”æ™®é€šç”¨æˆ·ï¼‰
- **å½±å“**ï¼šæ— å½±å“ï¼Œæ‰€æœ‰ä¸Šä¼ åŠŸèƒ½éƒ½ä½¿ç”¨ `userId`

## âœ… å·²åˆ é™¤çš„ä»£ç æ–‡ä»¶

1. `app/api/admin/login/route.ts` - ç®¡ç†å‘˜ç™»å½• API
2. `app/api/admin/register/route.ts` - ç®¡ç†å‘˜æ³¨å†Œ API
3. `app/api/admin/forgot-password/route.ts` - ç®¡ç†å‘˜å¿˜è®°å¯†ç  API
4. `app/api/admin/reset-password/route.ts` - ç®¡ç†å‘˜é‡ç½®å¯†ç  API
5. `app/api/admin/me/route.ts` - ç®¡ç†å‘˜ä¿¡æ¯ API
6. `lib/passwordReset.ts` - ç®¡ç†å‘˜å¯†ç é‡ç½®å·¥å…·

## âœ… å½“å‰æ•°æ®åº“è¡¨ç»“æ„

é¡¹ç›®ç°åœ¨åªåŒ…å«ä»¥ä¸‹ **5 ä¸ªè¡¨**ï¼Œä¸æ•°æ®åº“å®é™…ç»“æ„ä¸€è‡´ï¼š

| è¡¨å | ç”¨é€” | çŠ¶æ€ |
|------|------|------|
| **User** | æ™®é€šç”¨æˆ·è´¦æˆ·ï¼ˆVTuberï¼‰ | âœ… ä½¿ç”¨ä¸­ |
| **Page** | ç”¨æˆ·é¡µé¢é…ç½®ï¼ˆè‰ç¨¿/å‘å¸ƒï¼‰ | âœ… ä½¿ç”¨ä¸­ |
| **UserPasswordResetToken** | ç”¨æˆ·å¯†ç é‡ç½® Token | âœ… ä½¿ç”¨ä¸­ |
| **MediaAsset** | åª’ä½“èµ„æºï¼ˆå›¾ç‰‡ç­‰ï¼‰ | âœ… ä½¿ç”¨ä¸­ |
| **NewsArticle** | æ–°é—»æ–‡ç«  | âœ… ä½¿ç”¨ä¸­ |

## ğŸ” åŠŸèƒ½éªŒè¯

### âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- **ç™»å½•**ï¼š`/api/user/login` âœ… æ­£å¸¸
- **æ³¨å†Œ**ï¼š`/api/user/register` âœ… æ­£å¸¸
- **å¿˜è®°å¯†ç **ï¼š`/api/user/forgot-password` âœ… æ­£å¸¸
- **é‡ç½®å¯†ç **ï¼š`/api/user/reset-password` âœ… æ­£å¸¸
- **è·å–ç”¨æˆ·ä¿¡æ¯**ï¼š`/api/user/me` âœ… æ­£å¸¸

### âœ… é¡µé¢é…ç½®ç³»ç»Ÿ
- **è·å–è‰ç¨¿é…ç½®**ï¼š`/api/page/me` âœ… æ­£å¸¸
- **æ›´æ–°è‰ç¨¿é…ç½®**ï¼š`PUT /api/page/me` âœ… æ­£å¸¸
- **å‘å¸ƒé…ç½®**ï¼š`POST /api/page/me/publish` âœ… æ­£å¸¸
- **ä¸Šä¼ å›¾ç‰‡**ï¼š`POST /api/page/me/upload` âœ… æ­£å¸¸
- **è·å–å…¬å¼€é¡µé¢**ï¼š`/api/page/[slug]` âœ… æ­£å¸¸

### âœ… æ–°é—»æ–‡ç« ç³»ç»Ÿ
- **è·å–æ–‡ç« åˆ—è¡¨**ï¼š`/api/news/articles` âœ… æ­£å¸¸
- **è·å–å•ç¯‡æ–‡ç« **ï¼š`/api/news/articles/[id]` âœ… æ­£å¸¸
- **åˆ›å»ºæ–‡ç« **ï¼š`POST /api/news/articles` âœ… æ­£å¸¸
- **æ›´æ–°æ–‡ç« **ï¼š`PUT /api/news/articles/[id]` âœ… æ­£å¸¸
- **åˆ é™¤æ–‡ç« **ï¼š`DELETE /api/news/articles/[id]` âœ… æ­£å¸¸

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. **lib/session.ts ä¸­çš„ getAdminSession**
- **çŠ¶æ€**ï¼šå‡½æ•°ä»å­˜åœ¨ä½†æœªè¢«ä½¿ç”¨
- **å»ºè®®**ï¼šå¯ä»¥ä¿ç•™ï¼ˆä»¥é˜²å°†æ¥éœ€è¦ï¼‰æˆ–åˆ é™¤
- **å½±å“**ï¼šæ— å½±å“ï¼Œæ²¡æœ‰ä»£ç è°ƒç”¨å®ƒ

### 2. **è¿ç§»æ–‡ä»¶**
- **çŠ¶æ€**ï¼šæ—§çš„è¿ç§»æ–‡ä»¶ä»å­˜åœ¨äº `prisma/migrations/` ç›®å½•
- **å»ºè®®**ï¼šå¯ä»¥ä¿ç•™ï¼ˆå†å²è®°å½•ï¼‰æˆ–åˆ é™¤
- **å½±å“**ï¼šæ— å½±å“ï¼Œä¸å½±å“è¿è¡Œæ—¶

## ğŸ“ åç»­æ“ä½œå»ºè®®

### 1. è¿è¡Œ Prisma è¿ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰
å¦‚æœæ•°æ®åº“ç»“æ„ä¸ `schema.prisma` ä¸ä¸€è‡´ï¼Œéœ€è¦è¿è¡Œè¿ç§»ï¼š

```bash
# ç”Ÿæˆ Prisma Client
npx prisma generate

# å¦‚æœéœ€è¦åˆ›å»ºè¿ç§»ï¼ˆè°¨æ…æ“ä½œï¼‰
npx prisma migrate dev --name cleanup_unused_tables
```

### 2. éªŒè¯æ•°æ®åº“ç»“æ„
åœ¨ Supabase Dashboard ä¸­ç¡®è®¤ä»¥ä¸‹è¡¨å­˜åœ¨ï¼š
- âœ… `User`
- âœ… `Page`
- âœ… `UserPasswordResetToken`
- âœ… `MediaAsset`
- âœ… `NewsArticle`

### 3. æ¸…ç†æœªä½¿ç”¨çš„ä»£ç ï¼ˆå¯é€‰ï¼‰
- åˆ é™¤ `lib/session.ts` ä¸­çš„ `getAdminSession`ï¼ˆå¦‚æœç¡®å®šä¸éœ€è¦ï¼‰
- æ¸…ç†æ—§çš„è¿ç§»æ–‡ä»¶ï¼ˆå¦‚æœç¡®å®šä¸éœ€è¦å†å²è®°å½•ï¼‰

## âœ… ç»“è®º

**é¡¹ç›®å¯ä»¥æ­£å¸¸è¿è¡Œ**ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½ä½¿ç”¨æ­£ç¡®çš„ API ç«¯ç‚¹ï¼ˆ`/api/user/*` è€Œä¸æ˜¯ `/api/admin/*`ï¼‰ã€‚åˆ é™¤æœªä½¿ç”¨çš„è¡¨å®šä¹‰ä¸ä¼šå½±å“é¡¹ç›®åŠŸèƒ½ã€‚

